<!doctype html><html><head><meta charset=UTF-8><title>JavaScript异步编程-小结 - By luo0412</title><link rel=stylesheet href=//cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=//cdn.staticfile.org/prism/1.15.0/themes/prism.min.css><link rel=stylesheet href=//cdn.staticfile.org/KaTeX/0.10.0-rc.1/katex.min.css><link rel=stylesheet href=/static/css/nodeppt.css><link href=./css/chunk-vendors.bdd3c895.css rel=stylesheet></head><body><div><article id=webslides><section slide class="slide bg-black-blue aligncenter" image="https://cn.bing.com/az/hprichbg/rb/RainierDawn_EN-AU3730494945_1920x1080.jpg .dark"><span class="background dark" style="background-image:url('https://cn.bing.com/az/hprichbg/rb/RainierDawn_EN-AU3730494945_1920x1080.jpg')"></span><div class=wrap wrap=true><h2 class="text-landing text-shadow">JavaScript异步编程</h2><p class="text-intro animated fadeInUp delay-500">2019-12-12</p><p><a href=https://github.com/ui-javascript/ppt class="button ghost animated flipInX delay-1200" target=_blank><i class="fa fa-github"></i> Github</a></p></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>JavaScript-异步编程</h2><hr><ul><li>JavaScript异步编程六种方案 @simple<ul><li><a href=https://juejin.im/post/5c30375851882525ec200027 target=_blank>https:://juejin.im/post/5c30375851882525ec200027</a></li></ul></li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>异步编程发展史</h2><hr><blockquote><p>基于共享内存模型的伪线程模型</p></blockquote><ul><li>伪异步模型:: JSDeferred/jQuery Deferred --&gt; <code>promise</code> --&gt; generator/yield* --&gt; <code>(async+await)</code>/(await+promise)</li><li>数据交互:: ajax(XMLHttpRequest) -&gt; JSONP(基于script节点) --&gt; <code>jQuery.ajax</code> --&gt; <code>fetch</code>(jQuery.ajax的官方版本)</li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Callback 回调地狱</h2><hr><pre class=language-js><code class=language-js><span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理逻辑</span>
    <span class="token function">ajax</span><span class="token punctuation">(</span>url1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token comment">// 处理逻辑</span>
        <span class="token function">ajax</span><span class="token punctuation">(</span>url2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token comment">// 处理逻辑</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>观察者模式 Observers</h2><hr><ul><li>也就是<code>发布订阅</code></li><li>Node.js <code>EventEmitter</code><ul><li><a href=https://github.com/Olical/EventEmitter target=_blank>https:://github.com/Olical/EventEmitter</a> @nice --&gt; browser</li><li><a href=https://github.com/EventEmitter2/EventEmitter2 target=_blank>https:://github.com/EventEmitter2/EventEmitter2</a></li><li><a href=https://github.com/primus/eventemitter3 target=_blank>https:://github.com/primus/eventemitter3</a></li></ul></li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><pre class=language-js><code class=language-js><span class="token keyword">var</span> ee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ee<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">'create-user'</span><span class="token punctuation">,</span> sendCreateRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
ee<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">'request-complete'</span><span class="token punctuation">,</span> displayResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">sendCreateRequest</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sendRequest</span><span class="token punctuation">(</span><span class="token string">'create'</span><span class="token punctuation">,</span> arguments<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">success<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ee<span class="token punctuation">.</span><span class="token function">emitEvent</span><span class="token punctuation">(</span><span class="token string">'request-complete'</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">displayResponse</span><span class="token punctuation">(</span><span class="token parameter">success<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>success<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Yay!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Boo!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">sendRequest</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> data<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Kick everything off by emitting a create-user event.</span>
ee<span class="token punctuation">.</span><span class="token function">emitEvent</span><span class="token punctuation">(</span><span class="token string">'create-user'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Oliver Caldwell'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>事件监听 listeners</h2><hr><pre class=language-js><code class=language-js><span class="token keyword">function</span> <span class="token function">a</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> pubsub <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">pubSub</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> pubsub<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

a<span class="token punctuation">.</span>handlers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// 数据自己保存，不共存</span>
a<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">b</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello callback'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>事件机制 vs 观察者模式 @diff</h2><hr><ul><li><p>事件监听</p><ul><li>缺点:: 事件驱动, 很难看出主流程</li><li>优点:: 当目标对象被删除的时候，不会给整个系统残留一些无用的负担</li></ul></li><li><p>观察者模式</p></li><li><p>它们适合监听<code>多次</code>同类型的异步行为, 不适合<code>一次性</code>的异步行为</p></li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>JSDeferred</h2><hr><blockquote><p>Promise基石</p></blockquote><ul><li>@code <a href=https://github.com/cho45/jsdeferred target=_blank>https:://github.com/cho45/jsdeferred</a></li><li><code>单向链表</code></li><li>Deferred.next() @nice</li><li>Deferred.parallel() --&gt; 并归处理 --&gt; 3次重载</li><li>Deferred.connect()</li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>JSDeferred</h2><hr><pre class=language-js><code class=language-js><span class="token comment">// Define</span>
Deferred<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// next</span>
<span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Hello!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"World!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// parallel</span>
<span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/foo.json"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/bar.json"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/baz.json"</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">results</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// connect </span>
<span class="token comment">// 将函数封装成Deferred对象 --> 融入异步编程</span>
<span class="token keyword">var</span> timeout <span class="token operator">=</span> Deferred<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>setTimeout<span class="token punctuation">,</span> <span class="token punctuation">{</span> target<span class="token punctuation">:</span> window<span class="token punctuation">,</span> ok<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'after 1 sec'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>jQuery Deferred @ignore</h2><hr><ul><li>jQuery的Deferred基于3个Callbacks</li><li>API改了好几次</li><li>夹带太多的技术私货??</li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Fetch</h2><hr><blockquote><p>用于取代xhr</p></blockquote><ul><li>fetch返回的是带数据的Promise</li><li>fetch请求<code>默认不带cookie</code> --&gt; credentials</li><li>IE8/IE9 --&gt; 不支持CORS --&gt; fetch-jsonp</li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Fetch-实践</h2><hr><ul><li>如何使用 Fetch API 执行 HTTP 请求<ul><li><a href=https://www.css88.com/archives/9907 target=_blank>https:://www.css88.com/archives/9907</a></li></ul></li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Promise-教程</h2><hr><ul><li><p>MDN-promise</p><ul><li><a href=https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise target=_blank>https:://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise</a></li></ul></li><li><p>《ECMAScript 6 入门》-promise @nice</p><ul><li><a href=http://es6.ruanyifeng.com/##docs/promise target=_blank>http:://es6.ruanyifeng.com/##docs/promise</a></li></ul></li><li><p>JavaScript Promise迷你书</p><ul><li><a href=http://liubin.org/promises-book/ target=_blank>http://liubin.org/promises-book/</a></li></ul></li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Promise</h2><hr><ul><li>链式API --&gt; 回调里可以直接返回Promise --&gt; 接着撸代码</li><li>一旦从等待状态变成为其他状态就永远不能更改状态了 --&gt; 如果你错过了它，再去监听，是得不到结果的</li><li>Promise.prototype.then()</li><li>Promise.prototype.catch()</li><li>Promise.prototype.finally() --&gt; then()的特例</li><li>Promise.all()/Promise.race()</li><li>Promise.resolve()/Promise.reject()</li><li>@demo <a href=https://github.com/ui-javascript/natural-tpl-umi-mpa-react16-2019/blob/master/_ecma/async/promise/promise-all-catch.js target=_blank>链接</a></li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Promise-库</h2><hr><ul><li>bluebird @nice</li><li>when.js</li><li>q</li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Promise-标准</h2><hr><ul><li>Promise/A+</li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Promise-执行顺序</h2><hr><ul><li>首先按顺序执行同步任务</li><li>执行栈空了，执行事件队列，取出微任务</li><li>微任务永远在宏任务之前执行</li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Promise-执行顺序</h2><hr><pre class=language-js><code class=language-js><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'照样输出'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出顺序: </span>
<span class="token comment">// 2 -> 照样输出 -> 4 -> 3 -> 1</span>
</code></pre></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Promise-缺点</h2><hr><ul><li>无法取消Promise</li><li>如果不设置回调函数，Promise内部抛出的错误，不会反应到外部</li><li>当处于pending状态时，无法得知目前进展到哪一个阶段 --&gt; 刚刚开始还是即将完成??</li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>手写Promise</h2><hr><ul><li><p>mmPromise.js</p><ul><li><a href=https://github.com/RubyLouvre/mmDeferred/blob/master/mmPromise.js target=_blank>https:://github.com/RubyLouvre/mmDeferred/blob/master/mmPromise.js</a></li></ul></li><li><p>Promise实现原理（附源码）</p><ul><li><a href=https://juejin.im/post/5b83cb5ae51d4538cc3ec354 target=_blank>https:://juejin.im/post/5b83cb5ae51d4538cc3ec354</a></li></ul></li><li><p>这一次，彻底弄懂 Promise 原理</p><ul><li><a href=https://juejin.im/post/5d6f7c83e51d4561c541a712 target=_blank>https:://juejin.im/post/5d6f7c83e51d4561c541a712</a></li></ul></li><li><p>@demo <a href=https://github.com/ui-javascript/natural-tpl-umi-mpa-react16-2019/blob/master/_ecma/async/my-promise/libs/myPromise.js target=_blank>链接</a></p></li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>co</h2><hr><ul><li>为Node.js和浏览器打造的基于<code>生成器</code>的<code>流程控制</code>工具 --&gt; 更加优雅的方式编写非阻塞代码</li><li>@code <a href=https://github.com/tj/co target=_blank>https:://github.com/tj/co</a></li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Generator/yield* @ignore</h2><hr><blockquote><p>临时过渡</p></blockquote><ul><li>函数运行到yield时退出, 并<code>保留上下文</code>, 在下次进入时可以继续进行</li><li>浏览器支持并不好 --&gt; 很快就出了替代方案??</li><li>没有执行器</li><li>@demo <a href=https://github.com/ui-javascript/natural-tpl-umi-mpa-react16-2019/blob/master/_ecma/async/generator-yield/simple-yield-demo.js target=_blank>链接</a></li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Generator/yield* @ignore</h2><hr><pre class=language-js><code class=language-js><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 5 + 1 --> 6</span>
    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token punctuation">(</span>y <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 12 * 2 /3 --> 8</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> y <span class="token operator">+</span> z<span class="token punctuation">)</span> <span class="token comment">// 5 + 24 + 13 --> 42</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment">// 当执行第一次 next 时，传参会被忽略</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// => {value: 6, done: false}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// => {value: 8, done: false}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// => {value: 42, done: true}</span>
</code></pre></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Async/Await</h2><hr><blockquote><p>异步操作终极解决方案</p></blockquote><ul><li>不需要co启动器</li><li>await + Promise + then --&gt; 基本无敌</li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>Async/Await-实践</h2><hr><ul><li>使用 ES2017 中的 Async(异步) 函数 和 Await(等待)<ul><li><a href=https://www.css88.com/archives/7980 target=_blank>https:://www.css88.com/archives/7980</a></li></ul></li></ul><pre class=language-js><code class=language-js><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"App"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>h1<span class="token operator">></span>Hello <span class="token punctuation">{</span>data<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>异步编程-异常处理</h2><hr><ul><li>同步代码 --&gt; try/catch</li><li>非同步代码 --&gt; error-first</li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>参考</h2><hr><ul><li>《JavaScript框架设计》-第2版 @by 司徒正美</li><li>《深入浅出RxJS》 @by 程墨</li></ul></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>谢谢倾听</h2><hr><p><img src=/static/images/thinking/xiong-hand.jpg alt=""></p></div></section><section slide class=slide :class="size-50 aligncenter"><div class="wrap size-50 aligncenter" wrap=true><h2>RxJS</h2><hr><ul><li>Event Stream</li></ul></div></section></article></div><script>window.pluginsOptions = {}



document.addEventListener('DOMContentLoaded', () => {
    let isPrintMode = false;
    if(~location.search.indexOf('print-pdf')){
        isPrintMode = true;
        WebSlides.registerPlugin('scroll', function(){});
    }
    const ws = new WebSlides({
        loop: false
    })
    window.wsInstance = ws;
    if(isPrintMode){
        ws.slides.forEach(s=>s.show())
    }
}, false)</script><script src=./js/chunk-vendors.d658b63b.js></script><script src=./js/index.ad186c58.js></script></body></html>